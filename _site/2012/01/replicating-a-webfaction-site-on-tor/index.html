
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Replicating a Webfaction Site on Tor</title>
    
    <meta name="author" content="Max Bernstein">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/fasouto/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/fasouto/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/assets/themes/fasouto/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href='http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic' rel='stylesheet' type='text/css' />

  </head>

  <body>


    <div class="container">
      
        <header class="row main-header">
          <div class="span3 logo"><h3><a href="/">max bernstein</a></h3></div>  
          <div class="span4 offset5">
    <nav>
        <ul class="nav nav-pills nav-menu blog-navigation">
            <li class=""><a href="/projects">projects</a></li>
            <li class=""><a href="/archive.html">blog</a></li>
            <li class=""><a href="//photos.bernsteinbear.com">photos</a></li>
            <li class=""><a href="/about">about</a></li>
        </ul>
    </nav>
</div>
        </header>

      <div class="content">
        
<div class="page-header">
  <h1>Replicating a Webfaction Site on Tor <small></small></h1>
</div>

<div class="row">
  <div class="span8">
    <p>If you have a website hosted on Webfaction (or any other name-based virtual host, for that matter), and want to create a .onion copy of that website, then this guide is for you. After the break!</p>

<p>First, let&#8217;s get some definitions straight.</p>

<p><strong>name-based virtual host:</strong> One user has a <code>/home/</code> partition. Each application(could be multiple domains) routes to a specific folder in <code>~/webapps/</code>. <strong>Tor:</strong> Service that allows your web traffic is sent through around three random computers before reaching its target, in order to preserve anonymity. Illustration (click to enlarge):</p>

<p><span>caption id=&#8221;attachment_982&#8221; align=&#8221;alignnone&#8221; width=&#8221;300&#8221; caption=&#8221;geekyschmidt.com&#8221;</span>(/static/images/wp-content/uploads/2012/01/Tor-HTTP-Transmission-300x113.png)](/static/images/wp-content/uploads/2012/01/Tor-HTTP-Transmission.png)<span>/caption</span></p>

<p><strong>.onion:</strong> A domain that is resolved using a series of queries on the Tor network.</p>

<p>What we&#8217;ll be doing is pointing all of the Tor traffic that comes to the .onion to the daemon (in my case nginx) on the server.</p>

<p>I first contacted the Webfaction support staff to ask if this was allowed. I had to clarify several things:</p>

<p>1. I would not be needing a dedicated IP address</p>

<p>2. I would not be opening a port</p>

<p>3. This will not overload Webfaction with a barrage of traffic</p>

<p>He (Ryan S) then OK&#8217;d my actions. I downloaded the source package fromÂ the <a href='https://www.torproject.org/download/download.html.en'>Download page</a>, under &#8220;Source code.&#8221;</p>

<p>I unpacked, then ran:</p>

<pre><code>cd tor_folder/
./configure --prefix=$HOME
make
make install</code></pre>

<p>I now had a Tor binary in <code>~/bin/</code>. Right.</p>

<p>I then needed to make a directory in which Tor could store some of my website configuration files. I made it in <code>~/tor_config</code>.</p>

<p>I then edited <code>torrc</code> in order to configure the node correctly. That troublesome file was in <code>~/etc/tor/</code>.</p>

<p>It looked like a jumbled mess of code, I scrolled through until I found something that looks like:</p>

<pre><code>HiddenServiceDir some_folder/
HiddenServicePort 80 some_IP:port</code></pre>

<p>Change the first field, <code>HiddenServiceDir</code>, to match the folder from above. The second part was a bit trickier.</p>

<p>If you know what port and IP your server is running, then fantastic! Just leave the 80, and plug the rest of the information in.</p>

<p>(PSST! If you&#8217;re on Webfaction, it&#8217;s this:)</p>

<pre><code>HiddenServiceDir some_folder/
HiddenServicePort 80 localhost:2480</code></pre>

<p>Otherwise, you have two options:</p>

<p>1. Start up another httpd, like <code>lighthttpd</code>, in the directory where your application is stored, and change <code>some_IP:port</code> to <code>localhost:whatever_port</code> to match that.</p>

<p>2. Contact support and figure out what you can do</p>

<p>I opted to contact support, to reduce strain on the server.</p>

<p>I started Tor by running:</p>

<pre><code>~/bin/tor</code></pre>

<p>And the process spewed out some stuff like this: <a href='/static/images/wp-content/uploads/2012/01/Screen-shot-2012-01-16-at-4.15.23-PM.png'><img alt='' src='/static/images/wp-content/uploads/2012/01/Screen-shot-2012-01-16-at-4.15.23-PM-300x80.png' /></a></p>

<p>Then, I opened up my Control Panel (Webfaction&#8217;s unique panel), and configured my BernsteinBear website to also serve my .onion domain. I just added a domain (<code>.onion</code>)</p>

<pre><code>cat ~/path_to_tor/config_dir/hostname</code></pre>

<p>To see what&#8217;s in it.</p>

<p>Have fun!</p>

<p>P.S. If you really want to take this forward, change your site root to your .onion domain!</p>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2011/12/winter-break" title="Winter Break (will update)">&larr; Winter Break (will update)</a></li>
      
      
        <li class="next"><a href="/2012/03/cicada" title="3301">3301 &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    
  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>16 January 2012</span></div>
    <div class="rdbWrapper" data-show-read="1" data-show-send-to-kindle="1" data-show-print="0" data-show-email="0" data-orientation="0" data-version="1" data-bg-color="#fdfdfa"></div><script type="text/javascript">(function() {var s = document.getElementsByTagName("script")[0],rdb = document.createElement("script"); rdb.type = "text/javascript"; rdb.async = true; rdb.src = document.location.protocol + "//www.readability.com/embed.js"; s.parentNode.insertBefore(rdb, s); })();</script></div>
</div>


      </div>

    </div> <!-- /container -->

    

    <!-- IDL code -->
    <script type="text/javascript">
        window._idl = {};
        _idl.variant = "banner";
        (function() {
            var idl = document.createElement('script');
            idl.type = 'text/javascript';
            idl.async = true;
            idl.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'members.internetdefenseleague.org/include/?url=' + (_idl.url || '') + '&campaign=' + (_idl.campaign || '') + '&variant=' + (_idl.variant || 'banner');
            document.getElementsByTagName('body')[0].appendChild(idl);
        })();
    </script>
    
  </body>
</html>

